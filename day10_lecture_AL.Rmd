---
title: "Day 10 Lecture"
output: html_document
---
# homework
how to refer to both data and column in a function.  For instance, if want to specificy ACC and correct response in function arguments
```{r}
make.newcol <- function(data){
  HITS <- ifelse(data$correct_response=="0" & data$ACC==1,1,0)
  FA <- ifelse(data$correct_response=="0" & data$ACC==0,1,0)
  m <- ifelse(data$correct_response=="1" & data$ACC==0,1,0)
  cr <- ifelse(data$correct_response=="1" & data$ACC==1,1,0)
  data <- cbind(data, HITS, FA, m, cr) 
}

# attempt 1.  Use brackets and put quotes around arguments in function
ax <- read.csv("ax_AL.csv")
make.newcol <- function(data, x, x2){
  HITS <- ifelse(data[,x]=="0" & data[,x2]==1,1,0)
  FA <- ifelse(data[,x]=="0" & data[,x2]==0,1,0)
  m <- ifelse(data[,x]=="1" & data[,x2]==0,1,0)
  cr <- ifelse(data[,x]=="1" & data[,x2]==1,1,0)
  data <- cbind(data, HITS, FA, m, cr) 
}
ax <- make.newcol(ax, "correct_response", "ACC")
summary(ax)

# get() and filtering.  Could use to filter by correct responses, etc. 
# doesn't work
miris <- iris
myfunc <- function(data, colname) {
  output <- filter(data,colname == "setosa")
  output
}

myfunc(miris, "Species")

# use brackets to make it work
myfunc <- function(data, colname) {
  output <- filter(data,data[,colname] == "setosa")
  output
}
miris.setosa <- myfunc(miris, "Species")
summary(miris.setosa)
```


# Simulations
What do we mean by "simulations"?
  1. Generate some data
  2. Do some analysis
  3. Repeat! (a lot, usually)

# Important functions
   - distribution functions
    - e.g., `rnorm()`
   - mvrnorm
   - replicate
   - simulate
   - sims via loop
   - system.time

# Distributions
- dnorm - density, so the height of the normal density curve
- rnorm(number) - gives that number of values in a normal distribution
  - takes different means and sds
-scale() normalizes a vecotor.  Useful in ggplot
```{r}
# ?Distributions

norm.d <- data.frame(x = seq(-3, 3, .05))
norm.d$y <- dnorm(norm.d$x)
library(ggplot2)
ggplot(norm.d, aes(x, y)) + geom_line()
2*(1 - pnorm(1.96))  # get p-value for some test statistic
qnorm(.975)          # get critical value for some p

norm.data <- data.frame(x = rnorm(10000))
head(norm.data)
ggplot(norm.data, aes(x)) + geom_histogram()

norm.data2 <- data.frame(x = rnorm(10000, mean = 20, sd = 10))
head(norm.data2)
ggplot(norm.data2, aes(x)) + geom_histogram()
ggplot(norm.data2, aes(scale(x))) + geom_histogram() # the defaults for `scale()` normalize the vector

```


# Running some simulations

```{r}
library(MASS)

# n = number of rows, matrix is the correlation matrix
cor.data <- mvrnorm(n = 100, mu = c(0, 0), Sigma = matrix(c(1, .5, .5, 1), nrow = 2))
matrix(c(1, .5, .5, 1), nrow = 2)


# simulate 2 DV, not sure which is best, and 2 conditions (A, B).  They kindof correlate with one another. Could take the mean of them.  DO 3 t.tests  (dv1, dv2, and mean of dvs)
simA <- function(k = 20, n.cond = 2) {
  dvs <- mvrnorm(n = k*n.cond, mu = c(0,0), Sigma = matrix(c(1, .5, .5, 1), nrow = 2))
  this.data <- cbind(data.frame(condition = c(rep("A", k), rep("B", k))), dvs)
  colnames(this.data) <- c("condition", "DV1", "DV2")
  this.data$DV12 <- apply(this.data[, c("DV1", "DV2")], 1, mean)

  t1.p <- t.test(DV1 ~ condition, this.data)$p.value
  t2.p <- t.test(DV2 ~ condition, this.data)$p.value
  t3.p <- t.test(DV12 ~ condition, this.data)$p.value
  return(c(t1.p, t2.p, t3.p))
}
simA  

#replicate simA 1000 times
# system.time() tells you how long something took
system.time(sims <- replicate(1000, simA()))

sim.results <- data.frame(t1 = rep(NA, 10000), t2 = NA, t3 = NA)
# sim.results <- data.frame(t1 = NA, t2 = NA, t3= NA)  # slower
system.time(for(i in 1:1000) {
  sim.run <- simA()
  sim.results[i, ] <- sim.run
})

sims <- t(sims)
# get the false positive (p< .05) rate in the data which has no relationship  
sims.df <- as.data.frame(sims)
nrow(sims.df[sims.df$V1 < .05, ])/nrow(sims.df)
nrow(sims.df[sims.df$V2 < .05, ])/nrow(sims.df)
nrow(sims.df[sims.df$V3 < .05, ])/nrow(sims.df)
sims.df$sig <- apply(sims.df, 1, function(x) any(x < .05))
nrow(sims.df[sims.df$sig, ])/nrow(sims.df)
  
simB <- function(k = 20, k.plus = 10) {
  dvs <- mvrnorm(n = (k+k.plus)*2, mu = c(0,0), Sigma = matrix(c(1, .5, .5, 1), nrow = 2))
  this.data <- cbind(data.frame(condition = c(rep("A", k+k.plus), rep("B", k+k.plus)), dataset = c(rep("base", k), rep("extra", k.plus), rep("base", k), rep("extra", k.plus))), dvs)
  colnames(this.data) <- c("condition", "dataset", "DV1", "DV2")
  this.data$DV12 <- apply(this.data[, c("DV1", "DV2")], 1, mean)

  t1base.p <- t.test(DV1 ~ condition, this.data[this.data$dataset == "base", ])$p.value
  t1extra.p <- t.test(DV1 ~ condition, this.data)$p.value
  t2base.p <- t.test(DV2 ~ condition, this.data[this.data$dataset == "base", ])$p.value
  t2extra.p <- t.test(DV2 ~ condition, this.data)$p.value
  t12base.p <- t.test(DV12 ~ condition, this.data[this.data$dataset == "base", ])$p.value
  t12extra.p <- t.test(DV12 ~ condition, this.data)$p.value
  return(c(t1base.p, t1extra.p, t2base.p, t2extra.p, t12base.p, t12extra.p))
}
  
system.time(sims <- replicate(15000, simB()))
  
sims <- t(sims)
  
sims.df <- as.data.frame(sims)
nrow(sims.df[sims.df$V1 < .05, ])/nrow(sims.df)
nrow(sims.df[sims.df$V2 < .05, ])/nrow(sims.df)
nrow(sims.df[sims.df$V3 < .05, ])/nrow(sims.df)
sims.df$sigB1 <- apply(sims.df[, 1:2], 1, function(x) any(x < .05))
nrow(sims.df[sims.df$sigB1, ])/nrow(sims.df)
sims.df$sigB1 <- apply(sims.df[, 1:6], 1, function(x) any(x < .05))
nrow(sims.df[sims.df$sigB1, ])/nrow(sims.df)

```

```{r}
mysleep <- sleep
sleep.lm <- lm(extra ~ group, data = mysleep)
summary(sleep.lm)
anova(sleep.lm)
t.test(extra ~ group, data = mysleep, var.equal = TRUE)

sleep.sims <- simulate(sleep.lm, 10000)

for(i in 1:ncol(sleep.sims)) {
    
}





```



Git
  git add . # adds everything
 git add day9/ #adds everything in a local path
 git commit -m "updated day 9 materials"
 
 git pull origin master # pulls.  DO first before a push
 git push origin master #just pushes to internet (or wherever)
 
 git log --oneline # can see history and look at any of places
 git checkout 0519 # (one of the lines listed in the previous command)
 git checkout master # back to present 
 
branching
- do an alternate somehow and not change the main stuff
